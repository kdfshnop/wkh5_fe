{"version":3,"sources":["xf/list.min.js"],"names":["ListController","self","total","count","pageSize","paramGenerator","ParamGenerator","$","slideUp","require","Filter","BigData","init","ConningTower","data","console","log","param","di","to","li","st","id","mapping","key","type","value","goto","filter","extend","XFDEFAULT","el","cityId","near","longitude","latitude","controller","filterChanged","result","generateParamObj","forEach","item","pageUrl","location","href","replace","tmpArr","split","obj","queryString2Object","window","bindEvent","pullload","object2QueryString","click","str","imageUrl","estateName","districtName","townName","startSpace","endSpace","unitPrice","hideNoData","length","hide","createHouseItems","html","text","slideDown","setTimeout","insertTrendAndOldHouse","showNoData","append","show","cityName","$list","insertAfter","cookie","cityPinyin","apiUrl","xf","list","queryStringObject","pa","requestType","threshold","pageIndexKey","pageSizeKey","callback","newHouseDataListModelList","appendHouseList","Controller","document","ready"],"mappings":"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","file":"list.min.js","sourcesContent":["/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\n 1. 项目名称：悟空找房h5\r\n 2. 页面名称：xf/list(新房-列表)\r\n 3. 作者：tangxuyang@lifang.com\r\n -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/\r\n class ListController extends Controller {\r\n    constructor() {\r\n        super();\r\n        var self = this;\r\n        this.total = 0;//总数\r\n        this.count = 0;//当前数量\r\n        this.pageSize = 10;//\r\n        this.paramGenerator = new ParamGenerator();\r\n        $('.total').slideUp(1000);// 隐藏查询总条数        \r\n        require(['../components/filter.min', '../components/bigdata.min', \"../components/conning-tower.min\"], function(Filter, BigData){   \r\n            BigData.init(self);         \r\n            new ConningTower({                \r\n                \"bigDataUtil\" : BigData ,               \r\n                \"moduleType\" : \"xf\" ,\r\n                \"cityClick\" : (data) => {\r\n                } ,\r\n                \"searchResultItemClick\" : (data) => {\r\n                    console.log(data);\r\n                    // 与filter中的区域地铁互斥\r\n                    delete self.param.di;// 区域id\r\n                    delete self.param.to;// 板块id\r\n                    delete self.param.li;// 地铁线id\r\n                    delete self.param.st;// 地铁站id\r\n                    delete self.param.id;// 小区id\r\n                    var mapping = [\"\",\"sdi\",\"sto\",\"sli\",\"sst\",\"sid\"];\r\n                    var key = mapping[data.type];\r\n                    if(key){\r\n                        self.param[key] = data.value;\r\n                        self.goto();\r\n                    }\r\n                }\r\n            }) ;\r\n\r\n            self.filter = new Filter($.extend({},Filter.XFDEFAULT,{\r\n                el: \".filter\",                \r\n                cityId: 43,\r\n                near: false,\r\n                longitude: 222,\r\n                latitude: 234,                \r\n                controller: self,\r\n                BigData: BigData,\r\n                filterChanged: function(result){ \r\n                    // 获得最新查询条件TODO: 还要集成搜索组件                                     \r\n                    var param = self.paramGenerator.generateParamObj(result);\r\n                    if(param.di || param.to || param.li || param.st){\r\n                        // do nothing\r\n                    }else{// 判断是否有sid,sli,sst,sdi,sto\r\n                        var mapping = [\"sdi\",\"sto\",\"sli\",\"sst\",\"sid\"];\r\n                        mapping.forEach(function(item){\r\n                            if(self.param[item]){\r\n                                param[item] = self.param[item];\r\n                            }\r\n                        });                        \r\n                    }\r\n\r\n                    self.param = param;\r\n                    // 跳转\r\n                    self.goto();\r\n                }                \r\n            }));                     \r\n        });\r\n\r\n        // 从url中解析参数\r\n        var pageUrl = location.href;\r\n        pageUrl = pageUrl.replace('//','');\r\n        var tmpArr = pageUrl.split('/');\r\n        self.param = {};\r\n        if(tmpArr[3]){// 有查询条件\r\n            var obj = ParamGenerator.queryString2Object(tmpArr[3]);\r\n            if(obj){\r\n                self.param = obj;\r\n            }\r\n        }\r\n                    \r\n        window.filter = self.filter;\r\n\r\n        this.bindEvent();\r\n        this.pullload();\r\n    }\r\n\r\n    // 根据查询条件进行相应的跳转\r\n    goto(){\r\n        location.href = './' +  ParamGenerator.object2QueryString(this.param);                    \r\n    }\r\n\r\n    bindEvent(){\r\n        var self = this;\r\n        // 清空查询条件\r\n        $('.no-data button').click(function(){\r\n            // 跳转            \r\n            location.href = \"./\";\r\n        });\r\n    }    \r\n\r\n    createHouseItems(data){\r\n        var str = \"\";\r\n        data.forEach(function(item){\r\n            str += '<a class=\"xf-item\" href=\"/shanghai/rent/b5463d25fbc09ea7.html?channel=undefined\">\\\r\n                <div class=\"img\">\\\r\n                    <img src=\"'+item.imageUrl+'\">\\\r\n                    <div class=\"yh\">团购享 20万抵50万</div>\\\r\n                </div>\\\r\n                <div class=\"info\">\\\r\n                    <h3>'+item.estateName+'</h3>\\\r\n                    <p class=\"district-town-area\">\\\r\n                        <span>'+item.districtName+' '+item.townName+'</span><span>'+item.startSpace+'m-'+item.endSpace+'m</span>\\\r\n                    </p>\\\r\n                    <ul class=\"tags\">\\\r\n                        <li class=\"yh\">有优惠</li><li class=\"dt\">近地铁</li><li class=\"\">在售楼盘</li><li class=\"\">即将开盘</li><li class=\"\">即将开盘</li>\\\r\n                    </ul>\\\r\n                    <p class=\"unit-price\"><span>'+item.unitPrice+'</span> <span>元/m</span></p>\\\r\n                </div>\\\r\n            </a>';\r\n        });\r\n\r\n        return str;\r\n    }    \r\n\r\n    createHouseList(data,count){// 生成房源列表\r\n        this.hideNoData();\r\n        if(data && data.length){\r\n            $('.no-data').hide();\r\n            var str = this.createHouseItems(data);\r\n\r\n            $('#list').html(str);\r\n            $('.total .count').text(count);\r\n            $('.total').slideDown();\r\n            setTimeout(function(){\r\n                $('.total').slideUp();\r\n            }, 1500);\r\n\r\n            this.insertTrendAndOldHouse();\r\n        }else{// 没数据\r\n            this.showNoData();\r\n        }\r\n    }\r\n\r\n    appendHouseList(data){// 上拉滚动时加载数据\r\n        if(data&&data.length){\r\n            var str = this.createHouseItems(data);\r\n            $('#list').append(str);\r\n            this.insertTrendAndOldHouse();\r\n        }else{// 没有更多数据了\r\n            //this.showNoMore();\r\n        }\r\n    }\r\n\r\n    showNoData(){// 显示没有数据，并显示新房楼盘推荐\r\n        $('.no-data').show();\r\n        $('.total + div').html('');\r\n        $('.recommendation').show();// TODO:显示推荐楼盘\r\n    }\r\n\r\n    hideNoData(){\r\n        $('.no-data').hide();\r\n    }\r\n\r\n    hideNoMore(){\r\n        $('.reach-bottom').hide();\r\n    }\r\n\r\n    insertTrendAndOldHouse(){// 插入跳转到价格行情和二手房的链接        \r\n        var cityName = \"上海\";\r\n        var $list = $('#list .xf-item:not(.house):not(.house-price)');\r\n        if($('#list .house-price').length == 0 && $list.length>9){\r\n            $('<a href=\"#\" class=\"xf-item house-price\">\\\r\n                <div class=\"img\"></div>\\\r\n                <div class=\"info\">\\\r\n                    <h3>'+cityName+'房价涨了还是跌了？</h3>\\\r\n                    <span class=\"detail\">去看看</span>\\\r\n                </div>\\\r\n            </a>').insertAfter($($list[9]));\r\n        }\r\n        if($('#list .house').length == 0 && $list.length>19){\r\n            $('<a href=\"#\" class=\"xf-item house\">\\\r\n                <div class=\"img\"></div>\\\r\n                <div class=\"info\">\\\r\n                    <h3>火爆高性价比二手房</h3>\\\r\n                    <span class=\"detail\">去看看</span>\\\r\n                </div>\\\r\n            </a>').insertAfter($list[19]);\r\n        }\r\n    }\r\n\r\n    showError(){// 接口报错，分为两种，1. 筛选条件变更刷新 2. 上拉加载\r\n\r\n    }\r\n\r\n    // 金箍棒loading效果，现在第一屏用同步输出 ，已经用不到了，先保留，后续删掉\r\n    // showLoading(){\r\n    //     $('.page-loading').show();\r\n    // }\r\n\r\n    // hideLoading(){\r\n    //     $('.page-loading').hide();\r\n    // }\r\n\r\n    // 上拉加载\r\n    pullload(){\r\n        let self = this ;\r\n        var cityId = $.cookie(\"xfSelectedCityId\");\r\n        var cityPinyin = $.cookie(\"xfSelectedCityPinyin\");\r\n        var cityName = $.cookie(\"xfSelectedCityName\");\r\n        \r\n        //二手房\r\n        $(\"#list\").pullload({\r\n            apiUrl : self.apiUrl.xf.list ,\r\n            queryStringObject : function(){\r\n                self.param && delete self.param.pa;\r\n                if(!self.param){\r\n                    self.param = {};\r\n                }\r\n                return self.param;\r\n            },   \r\n            requestType: \"POST\",\r\n            threshold : 50 ,\r\n            pageSize: 10,   \r\n            pageIndexKey: \"of\",\r\n            pageSizeKey: \"ps\",    \r\n            callback : function(data) {\r\n                \r\n                if( !data.data || !data.data.newHouseDataListModelList || !data.data.newHouseDataListModelList.length){\r\n                    data.count = 1;\r\n                    return;    \r\n                } \r\n\r\n                self.appendHouseList(data.data.newHouseDataListModelList);                \r\n            }\r\n        }) ;\r\n    }\r\n}\r\n\r\n\r\n\r\n/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\n类的初始化\r\n-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/\r\n$(document).ready(function() {\r\n    new ListController;\r\n});"]}