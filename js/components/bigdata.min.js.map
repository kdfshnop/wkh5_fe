{"version":3,"sources":["components/bigdata.min.js"],"names":["define","s4","Math","random","toString","substring","guid","getCookieId","localStorage","cookieId","getDeviceId","cb","bigData","data","deviceId","projectId","total","getTotal","pNum","setTotal","send","ls","getLocalStorage","window","bigDataTotal","parseInt","controller","item","request","apiUrl","successCallback","isShowErrorTips","document","body","addEventListener","event","$target","$","target","JSON","parse","decodeURIComponent","type","$parents","parents","length","init","c"],"mappings":"AAAA,YAKAA,QAAO,WACH,QAASC,KACL,OAAiC,OAAtB,EAAIC,KAAKC,UAAwB,GAAIC,SAAS,IAAIC,UAAU,GAG3E,QAASC,KACL,MAAOL,KAAOA,IAAO,IAAMA,IAAO,IAAMA,IAAO,IAAMA,IAAO,IAAMA,IAAOA,IAAOA,IAGpF,QAASM,KAEL,MADIC,cAAaC,WAAWD,aAAaC,SAAWH,KAC7CE,aAAaC,SAIxB,QAASC,GAAYC,GAIjBA,EAAGJ,KAmEP,QAASK,GAAQC,GACbH,EAAY,SAASI,GACjBD,EAAKJ,SAAWK,EAChBD,EAAKE,UAAY,CACjB,IAAIC,GAAQC,GACZJ,GAAKK,KAAOF,EACZG,EAASH,EAAM,GACfI,EAAKP,KAvEb,GAAIQ,MACAC,EAAkB,WAClB,MAAOC,QAAOf,cAAgBa,GAiB9BJ,EAAW,WACX,MAAGK,KAAkBE,aACVC,SAASH,IAAkBE,cAE3B,GAIXL,EAAW,SAASH,GACpBM,IAAkBE,aAAeR,GAWjCU,EAAAA,OACAN,EAAO,SAASO,GAChB,GAAGD,EAAW,CACET,GAEZS,GAAWE,QAAQF,EAAWG,OAAOjB,QAAQe,GACzCG,gBAAiB,aAGjBC,iBAAiB,KAgD7B,OApBAR,QAAOS,SAASC,KAAKC,iBAAiB,QAAQ,SAASC,GAEnD,GAAIC,GAAUC,EAAEF,EAAMG,QAClBzB,EAAOuB,EAAQvB,KAAK,UACxB,IAAGA,EACCA,EAAO0B,KAAKC,MAAMC,mBAAmB5B,IACrCA,EAAK6B,KAAO,EACZ9B,EAAQC,OACP,CACD,GAAI8B,GAAWP,EAAQQ,QAAQ,iBAE5BD,GAASE,OAAO,IACfhC,EAAO8B,EAAS9B,KAAK,WACrBA,EAAO0B,KAAKC,MAAMC,mBAAmB5B,IACrCA,EAAK6B,KAAO,EACZ9B,EAAQC,OAGlB,IAGEiC,KAAM,SAASC,GACXrB,EAAaqB,GAEjBnC,QAASA","file":"bigdata.min.js","sourcesContent":["/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------\n 1. 项目名称：悟空找房h5\n 2. 页面名称：components -> bigdata(埋点)\n 3. 作者：tangxuyang@lifang.com\n -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/\ndefine(function(){\n    function s4() {\n        return ((( 1 + Math.random() ) * 0x10000) | 0 ).toString(16).substring(1) ;\n    }\n    //生成GUID\n    function guid() {\n        return s4() + s4() + \"-\" + s4() + \"-\" + s4() + \"-\" + s4() + \"-\" + s4() + s4() + s4() ; \n    } \n    //从localStorage里面取得cookieId，如果没有用guid填充再返回\n    function getCookieId() {\n        if(!localStorage.cookieId ) localStorage.cookieId = guid() ;\n        return localStorage.cookieId ;\n    }\n\n    //获取设备Id\n    function getDeviceId(cb){\n        //原生优先，然后取localStorage\n        //当前页面都是分享页，没有跟native交互的场景，因此native交互这块先不实现\n\n        cb(getCookieId());\n    }\n\n    let ls = {};\n    let getLocalStorage = function(){\n        return window.localStorage || ls;\n    };\n\n    //从localStorage中读取未成功的大数据埋点\n    let getBigData = function(){\n        if(getLocalStorage().bigData){\n            return JSON.parse(getLocalStorage().bigData);\n        }else{\n            return [];\n        }\n    };\n\n    //设置未成功的大数据埋点到localStorage\n    let setBigData = function(data){\n        getLocalStorage().bigData = JSON.stringify(data);\n    };\n\n    let getTotal = function(){\n        if(getLocalStorage().bigDataTotal){\n            return parseInt(getLocalStorage().bigDataTotal);\n        }else{\n            return 1;\n        }\n    }\n\n    let setTotal = function(total){\n        getLocalStorage().bigDataTotal = total;\n    }\n\n    //插入一条埋点数据到localStorage\n    let insertBigData = function(item){\n        let items = getBigData()||[];\n        items.push(item);\n        setBigData(items);\n    }\n\n    //发送埋点请求\n    let controller;\n    let send = function(item){\n        if(controller){\n            let total = getTotal();\t\n\n            controller.request(controller.apiUrl.bigData,item,{\n                successCallback: function(){\n\n                },\n                isShowErrorTips: false,\n            });            \n        }\n        \n    };\n\n    //从localStorage中读取一个bigData发送出去\n    let traverse = function(){\n        let items = getBigData();\n        if(items && items.length > 0){\n            let item = items.splice(0,1)[0];\n            setBigData(items);\n            send(item);\n        }\n    };\n\n    function bigData(data){               \n        getDeviceId(function(deviceId){\n            data.cookieId = deviceId;\n            data.projectId = 2;\n            let total = getTotal();\n            data.pNum = total;\n            setTotal(total+1);\n            send(data);\n        });        \n    };\n\n    //body上注册click事件，监听click事件\n    window.document.body.addEventListener(\"click\",function(event){\n        //判断是否埋点元素\n        let $target = $(event.target);\n        let data = $target.data('bigdata');\n        if(data){\t\t\t\t\t\t\t\t\n            data = JSON.parse(decodeURIComponent(data));\n            data.type = 2;//事件埋点的类型是2,1是pv\t\t\t\t\n            bigData(data);\n        }else{\n            let $parents = $target.parents('[data-bigdata]');\n            \n            if($parents.length>0){\t\t\t\t\t\n                data = $parents.data('bigdata');\n                data = JSON.parse(decodeURIComponent(data));\n                data.type = 2;\n                bigData(data);\n            }\n        }\n    },true);\n\n    return {\n        init: function(c){\n            controller = c;\n        },\n        bigData: bigData\n    };\n});\n"]}